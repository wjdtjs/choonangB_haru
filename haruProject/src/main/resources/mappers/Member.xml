<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.haruProject.MemberMapper">
	<select id="HJGetTotalMember" resultType="int">
		SELECT count(*) 
		FROM member
	</select>
	
	<select id="HJSelectMembers" parameterType="Map" resultType="Member">
		SELECT *
		FROM (
				SELECT ROWNUM rn, a.*
			  	FROM (
			  			SELECT mb.*,
			  				   cm.content mstatis_content
			  			FROM member mb
			  			JOIN common cm ON mb.mstatus_bcd = cm.bcd and mb.mstatus_mcd =cm.mcd
			  			<if test="search.type4 != 0 and !search.type4.equals('')">
			  				<if test="search.type4 != 999">
									WHERE mb.mstatus_mcd = #{search.type4}
			  				</if>
						</if>
						<if test="(search.type5 != 0 and !search.type5.equals('')) and (search.search1 != null and !search.search1.equals(''))">
			  				<choose>
			  					<when test="search.type5 == 1">
			  						WHERE mb.mname LIKE '%' || #{search.search1} || '%
			  					</when>
			  					<when test="search.type5 == 2">
			  						WHERE mb.mtel LIKE '%' || #{search.search1} || '%
			  					</when>
			  				</choose>
						</if>
						<if test="(search.type4 != 0 and !search.type4.equals('')) and (search.type5 != 0 and !search.type5.equals('')) and (search.search1 != null and !search.search1.equals(''))">
			  				<choose>
			  					<when test="search.type5 == 1 and search.type4 != 999">
			  						WHERE mb.mname LIKE '%' || #{search.search1} || '% and mb.mstatus_mcd = #{search.type4}
			  					</when>
			  					<when test="search.type5 == 2 and search.type4 != 999">
			  						WHERE mb.mtel LIKE '%' || #{search.search1} || '%  and mb.mstatus_mcd = #{search.type4}
			  					</when>
			  				</choose>
						</if>
			  			
						ORDER BY memno desc
			  		) a
		)
		WHERE rn BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="HJMemberDetail" parameterType="int" resultType="Member">
		SELECT 
				mb.memno,
				mb.mid,
				mb.mpasswd,
				mb.mname,
				mb.mtel,
				mb.memail,
				mb.reg_date,
				mb.update_date,
				mb.is_agree,
				mb.agree_date,
				mb.mstatus_mcd,
				mb.mstatus_bcd,
				cm.content mstatis_content
		FROM member mb
		JOIN common cm ON mb.mstatus_bcd = cm.bcd and mb.mstatus_mcd =cm.mcd
		WHERE memno = #{memno}
	</select>
	
	<insert id="HJInsertMember" parameterType="Member">
		<if test="mpasswd == re_mpasswd">
			INSERT INTO member(memno,mid,mpasswd,mname,mtel,memail,reg_date,is_agree,agree_date)
			VALUES (seq_mem.nextval,#{mid},#{mpasswd},#{mname},#{mtel},#{memail},sysdate,#{is_agree},
						<if test="is_agree == 1">
							sysdate
						</if>
						<if test="is_agree == 0">
							null
						</if>
					)
		
		</if>
	</insert>
	
	<select id="HJMstatusList" resultType="Common">
		SELECT *
		FROM common
		WHERE bcd = 200
	</select>
	
	<select id="HJMstatusList1" resultType="Common">
		SELECT *
		FROM common
		WHERE bcd = 200 AND mcd != 999
	</select>
	
	<update id="HJUpdateMember" parameterType="Member">
		UPDATE member SET
			mname = #{mname},
			mtel = #{mtel},
			memail = #{memail},
			mpasswd = #{mpasswd},
			mstatus_mcd = #{mstatus_mcd},
			is_agree = #{is_agree},
			<if test="is_agree == 1">
				agree_date = sysdate,
			</if>
			<if test="is_agree == 0">
				agree_date = null,
			</if>
			update_date = sysdate
		WHERE memno = #{memno}
	</update>
	
	<select id="HJCheckID" parameterType="java.lang.String" resultType="Member">
		SELECT *
		FROM member
		WHERE mid = #{mid}
	</select>
</mapper>