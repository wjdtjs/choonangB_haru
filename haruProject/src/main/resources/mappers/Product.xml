<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.haruProject.ProductMapper">

	
	
	<!-- SELECT -->
	<!-- 필터 적용된 상품 리스트 수 조회 -->
	<select id="JS_SelectTotalProductCnt" parameterType="SearchItem" resultType="int">
		SELECT COUNT(*) FROM PRODUCT  
		<if test="(search1 != null and !search1.equals('')) or (search2 != null and !search2.equals(''))">
			WHERE
		</if>
		<if test="search1 != null and !search1.equals('')">
			PNAME LIKE '%' || #{search1} || '%'
		</if>
		<if test="(search1 != null and !search1.equals('')) and (search2 != null and !search2.equals(''))">
			AND
		</if>
		<if test="search2 != null and !search2.equals('')">
			PSTATUS_MCD = #{search2}
		</if>
	</select>
	
	<!-- 상품 상태 공통데이터 종류 조회 
		(SCD - 300: 노출여부 | MCD - 100:노출, 200:비노출) 
	-->
	<select id="JS_SelectCommonStatus" resultType="Map">
		SELECT CONTENT, BCD, MCD
		FROM COMMON
		WHERE SCD = 300 AND MCD IN (100, 200)
	</select>
	
	<!-- 상품 분류 공통데이터 종류 조회 
		(SCD - 400: 상품종류)
	-->
	<select id="JS_SelectProductBCD" resultType="Map">
		SELECT CONTENT, BCD
		FROM COMMON
		WHERE SCD = 400 AND MCD = 999
	</select>
	
	<!-- 상품 분류 공통데이터 중분류 조회 
	-->
	<select id="JS_SelectProductMCD" parameterType="int" resultType="Map">
		SELECT CONTENT, MCD
		FROM COMMON
		WHERE SCD = 400 AND BCD = #{bcd} AND MCD != 999
	</select>

	<!-- 상품 리스트 조회 -->
	<select id="JS_SelectProductList" parameterType="Map" resultType="Product">
		SELECT *
		FROM (
			SELECT ROWNUM rn, p.*
			FROM (
				SELECT PNO, PNAME, PPRICE, REG_DATE, PBRAND, cm.CONTENT as status, PQUANTITY, PSTEP_BCD, PSTEP_MCD
				FROM PRODUCT pp INNER JOIN COMMON cm
				ON
				pp.PSTATUS_BCD = cm.BCD AND pp.PSTATUS_MCD = cm.MCD
				<if test="search.search1 != null and !search.search1.equals('')">
					AND PNAME LIKE '%' || #{search.search1} || '%'
				</if>
				<if test="search.search2 != null and !search.search2.equals('')">
					AND PSTATUS_MCD = #{search.search2}
				</if>
				ORDER BY TO_NUMBER(PNO) DESC
			) p
		)
		WHERE rn BETWEEN #{startRow} AND #{endRow} 
	</select>
	
	<!-- 상품상세 조회 -->
	<select id="JS_SelectProductDetail" parameterType="java.lang.String" resultType="Product">
		SELECT PNO, PNAME, PPRICE, PBUY_STORE, PIMG_MAIN, UPDATE_DATE, PBRAND, PDETAILS, PSTATUS_BCD, PSTATUS_MCD, PQUANTITY, PSTEP_BCD, PSTEP_MCD
		FROM PRODUCT
		WHERE PNO = #{pno}
	</select>
	<!-- End SELECT -->
	
	
	<!-- INSERT -->
	<!-- 상품 등록 -->
	<insert id="JS_InsertProduct" parameterType="Product">
		INSERT INTO PRODUCT(
			PNO, PNAME, PPRICE, PBUY_STORE, PIMG_MAIN, PBRAND, PDETAILS, PQUANTITY, PSTEP_BCD, PSTEP_MCD
		) VALUES(
			SEQ_PRO.NEXTVAL, 
			#{pname}, 
			#{pprice}, 
			#{pbuy_store}, 
			#{pimg_main}, 
			#{pbrand}, 
			#{pdetails}, 
			#{pquantity}, 
			#{pstep_bcd}, 
			#{pstep_mcd}
		)
	</insert>
	<!-- End INSERT -->
	
	<!-- UPDATE -->
	<!-- 상품 수정 -->
	<update id="JS_UpdateProduct" parameterType="Product">
		UPDATE PRODUCT SET
			PNAME = #{pname},
			PPRICE = #{pprice},
			PBUY_STORE = #{pbuy_store},
			PIMG_MAIN = #{pimg_main},
			PBRAND = #{pbrand},
			PDETAILS = #{pdetails},
			PQUANTITY = #{pquantity},
			PSTEP_BCD = #{pstep_bcd},
			PSTEP_MCD = #{pstep_mcd},
			PSTATUS_MCD = #{pstatus_mcd},
			UPDATE_DATE = sysdate
		WHERE PNO = #{pno}
	</update>
	
</mapper>